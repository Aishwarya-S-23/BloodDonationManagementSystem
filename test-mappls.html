<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mappls Integration</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 500px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .controls {
            margin-bottom: 20px;
        }
        button {
            padding: 8px 16px;
            margin-right: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #status {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Test Mappls Integration</h1>

    <div class="controls">
        <button onclick="initializeMap()">Initialize Map</button>
        <button onclick="addMarker()">Add Marker</button>
        <button onclick="addCircle()">Add Circle</button>
        <button onclick="clearAll()">Clear All</button>
    </div>

    <div id="status">Status: Not initialized</div>

    <div id="map"></div>

    <script>
        const MAPPLS_API_KEY = '0d0a98cacebb8518543bc0541898000c';
        let map = null;
        let markers = [];
        let circles = [];

        function updateStatus(message) {
            document.getElementById('status').textContent = 'Status: ' + message;
            console.log(message);
        }

        async function loadMapplsSDK() {
            return new Promise((resolve, reject) => {
                if (window.mappls && window.mappls.Map) {
                    updateStatus('SDK already loaded');
                    resolve();
                    return;
                }

                updateStatus('Loading Mappls SDK...');

                const script = document.createElement('script');
                script.src = `https://apis.mappls.com/advancedmaps/api/${MAPPLS_API_KEY}/map_sdk?layer=vector&v=3.0`;
                script.async = true;
                script.defer = true;

                script.onload = () => {
                    const checkSdkReady = () => {
                        if (window.mappls && window.mappls.Map) {
                            updateStatus('SDK loaded successfully');
                            resolve();
                        } else {
                            setTimeout(checkSdkReady, 100);
                        }
                    };
                    checkSdkReady();
                };

                script.onerror = (error) => {
                    updateStatus('Failed to load SDK: ' + error.message);
                    reject(error);
                };

                document.head.appendChild(script);

                setTimeout(() => {
                    if (!window.mappls || !window.mappls.Map) {
                        updateStatus('SDK loading timeout');
                        reject(new Error('SDK loading timeout'));
                    }
                }, 15000);
            });
        }

        async function initializeMap() {
            try {
                await loadMapplsSDK();

                updateStatus('Initializing map...');

                const mapContainer = document.getElementById('map');

                map = new window.mappls.Map(mapContainer, {
                    center: [28.6139, 77.2090], // Delhi
                    zoom: 12,
                    zoomControl: true,
                    fullscreenControl: true,
                    geolocation: false,
                    traffic: false
                });

                updateStatus('Map initialized successfully');

            } catch (error) {
                updateStatus('Map initialization failed: ' + error.message);
                console.error('Map initialization error:', error);
            }
        }

        function addMarker() {
            if (!map) {
                updateStatus('Map not initialized');
                return;
            }

            try {
                updateStatus('Adding marker...');

                const marker = new window.mappls.Marker({
                    position: [28.6139, 77.2090],
                    map: map,
                    title: 'Test Marker'
                });

                markers.push(marker);
                updateStatus('Marker added successfully');

            } catch (error) {
                updateStatus('Failed to add marker: ' + error.message);
                console.error('Marker error:', error);
            }
        }

        function addCircle() {
            if (!map) {
                updateStatus('Map not initialized');
                return;
            }

            try {
                updateStatus('Adding circle...');

                const circle = new window.mappls.Circle({
                    center: [28.6139, 77.2090],
                    radius: 1000, // 1km
                    map: map,
                    strokeColor: '#FF0000',
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.2
                });

                circles.push(circle);
                updateStatus('Circle added successfully');

            } catch (error) {
                updateStatus('Failed to add circle: ' + error.message);
                console.error('Circle error:', error);
            }
        }

        function clearAll() {
            updateStatus('Clearing all overlays...');

            markers.forEach(marker => {
                try {
                    marker.setMap(null);
                } catch (e) {
                    console.error('Error removing marker:', e);
                }
            });
            markers = [];

            circles.forEach(circle => {
                try {
                    circle.setMap(null);
                } catch (e) {
                    console.error('Error removing circle:', e);
                }
            });
            circles = [];

            updateStatus('All overlays cleared');
        }

        // Auto-initialize when page loads
        window.addEventListener('load', () => {
            updateStatus('Page loaded, ready to initialize map');
        });
    </script>
</body>
</html>
